<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ destination.name }} - Tourism Guide</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìç</text></svg>">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        .hero-image {
            height: 500px;
            background-size: cover;
            background-position: center;
            position: relative;
        }
        .hero-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
            color: white;
            padding: 40px;
        }
        .info-card {
            border-left: 4px solid #667eea;
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 15px;
        }
        .rating {
            color: #ffc107;
            font-size: 1.2rem;
        }
        #map {
            height: 400px;
            border-radius: 10px;
        }
        .gallery-img {
            height: 150px;
            object-fit: cover;
            border-radius: 5px;
            cursor: pointer;
            transition: transform 0.3s;
        }
        .gallery-img:hover {
            transform: scale(1.05);
        }
        .review-card {
            border-left: 4px solid #28a745;
            background: #f8f9fa;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 5px;
        }
        .star-rating {
            display: flex;
            gap: 5px;
            font-size: 2rem;
            cursor: pointer;
            flex-direction: row-reverse;
            justify-content: flex-end;
        }
        .star-rating input {
            display: none;
        }
        .star-rating label {
            color: #ddd;
            cursor: pointer;
        }
        .star-rating label:hover,
        .star-rating label:hover ~ label,
        .star-rating input:checked ~ label {
            color: #ffc107;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-map-marked-alt"></i> Tourism Guide
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/"><i class="fas fa-home"></i> Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/#destinations"><i class="fas fa-map-pin"></i> Destinations</a>
                    </li>
                    {% if current_user %}
                        <li class="nav-item">
                            <span class="nav-link">üëã {{ current_user.username }}</span>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/logout"><i class="fas fa-sign-out-alt"></i> Logout</a>
                        </li>
                    {% else %}
                        <li class="nav-item">
                            <a class="nav-link" href="/login"><i class="fas fa-sign-in-alt"></i> Login</a>
                        </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>

    {% if success %}
    <div class="alert alert-success alert-dismissible fade show m-3">
        <i class="fas fa-check-circle"></i> Thank you! Your review has been submitted successfully.
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    {% endif %}

    <!-- Hero Section -->
    <div class="hero-image" style="background-image: url('{% if destination.image_path %}{{ UPLOAD_URL }}{{ destination.image_path }}{% else %}https://via.placeholder.com/800x400?text={{ destination.name }}{% endif %}');">
        <div class="hero-overlay">
            <div class="container">
                <span class="badge bg-primary mb-2">
                    <i class="fas {{ destination.icon }}"></i> {{ destination.category_name }}
                </span>
                <h1 class="display-4 fw-bold">{{ destination.name }}</h1>
                {% if rating_count > 0 %}
                    <div class="rating mb-2">
                        {% for i in range(5) %}
                            {% if i < avg_rating|round|int %}
                            <i class="fas fa-star"></i>
                            {% else %}
                            <i class="far fa-star"></i>
                            {% endif %}
                        {% endfor %}
                        <span class="ms-2">{{ avg_rating|round(1) }} / 5</span>
                        <span class="ms-2">({{ rating_count }} reviews)</span>
                    </div>
                {% endif %}
                <p class="lead"><i class="fas fa-map-marker-alt"></i> {{ destination.address }}</p>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container my-5">
        <div class="row">
            <div class="col-lg-8">
                <!-- Description -->
                <div class="card mb-4">
                    <div class="card-body">
                        <h3 class="card-title"><i class="fas fa-info-circle"></i> About This Place</h3>
                        <p class="card-text">{{ destination.description|nl2br|safe }}</p>
                    </div>
                </div>

                <!-- Gallery -->
                {% if images %}
                <div class="card mb-4">
                    <div class="card-body">
                        <h3 class="card-title"><i class="fas fa-images"></i> Photo Gallery</h3>
                        <div class="row g-2">
                            {% for img in images %}
                            <div class="col-md-4">
                                <img src="{{ UPLOAD_URL }}{{ img.image_path }}" 
                                     class="img-fluid gallery-img" 
                                     alt="{{ img.caption }}">
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- Map -->
                {% if destination.latitude and destination.longitude %}
                <div class="card mb-4">
                    <div class="card-body">
                        <h3 class="card-title"><i class="fas fa-map"></i> Location</h3>
                        <div id="map"></div>
                    </div>
                </div>
                {% endif %}

                <!-- Reviews -->
                <div class="card mb-4">
                    <div class="card-header bg-success text-white">
                        <h4 class="mb-0"><i class="fas fa-comments"></i> Reviews & Ratings</h4>
                    </div>
                    <div class="card-body">
                        {% if reviews %}
                            <h5 class="mb-3">What visitors are saying:</h5>
                            {% for review in reviews %}
                            <div class="review-card">
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <div>
                                        <h6 class="mb-1"><i class="fas fa-user-circle"></i> {{ review.user_name }}</h6>
                                        <div class="rating" style="font-size: 1rem;">
                                            {% for i in range(5) %}
                                                {% if i < review.rating %}
                                                <i class="fas fa-star"></i>
                                                {% else %}
                                                <i class="far fa-star"></i>
                                                {% endif %}
                                            {% endfor %}
                                        </div>
                                    </div>
                                    <small class="text-muted">
                                        <i class="fas fa-clock"></i> {{ review.created_at.strftime('%b %d, %Y') }}
                                    </small>
                                </div>
                                <p class="mb-0">{{ review.comment|nl2br|safe }}</p>
                            </div>
                            {% endfor %}
                        {% else %}
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle"></i> No reviews yet. Be the first to share your experience!
                            </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Write Review -->
                <div class="card mb-4">
                    <div class="card-header bg-primary text-white">
                        <h4 class="mb-0"><i class="fas fa-pen"></i> Write a Review</h4>
                    </div>
                    <div class="card-body">
                        <form method="POST" action="/destination/{{ destination.id }}/review">
                            <div class="mb-3">
                                <label class="form-label">Your Name <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" name="review_name" 
                                       value="{% if current_user %}{{ current_user.username }}{% endif %}" required>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Rating <span class="text-danger">*</span></label>
                                <div class="star-rating">
                                    <input type="radio" name="rating" value="5" id="star5" required>
                                    <label for="star5"><i class="fas fa-star"></i></label>
                                    <input type="radio" name="rating" value="4" id="star4">
                                    <label for="star4"><i class="fas fa-star"></i></label>
                                    <input type="radio" name="rating" value="3" id="star3">
                                    <label for="star3"><i class="fas fa-star"></i></label>
                                    <input type="radio" name="rating" value="2" id="star2">
                                    <label for="star2"><i class="fas fa-star"></i></label>
                                    <input type="radio" name="rating" value="1" id="star1">
                                    <label for="star1"><i class="fas fa-star"></i></label>
                                </div>
                                <small class="text-muted">Click on the stars to rate</small>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Your Review <span class="text-danger">*</span></label>
                                <textarea class="form-control" name="comment" rows="4" 
                                          placeholder="Share your experience..." required></textarea>
                            </div>

                            <button type="submit" class="btn btn-success">
                                <i class="fas fa-paper-plane"></i> Submit Review
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="col-lg-4">
                <!-- Quick Info -->
                <div class="card mb-4">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="fas fa-clipboard-list"></i> Quick Information</h5>
                    </div>
                    <div class="card-body">
                        {% if destination.opening_hours %}
                        <div class="info-card">
                            <h6><i class="fas fa-clock"></i> Opening Hours</h6>
                            <p class="mb-0">{{ destination.opening_hours }}</p>
                        </div>
                        {% endif %}

                        {% if destination.entry_fee %}
                        <div class="info-card">
                            <h6><i class="fas fa-ticket-alt"></i> Entry Fee</h6>
                            <p class="mb-0">{{ destination.entry_fee }}</p>
                        </div>
                        {% endif %}

                        {% if destination.contact_number %}
                        <div class="info-card">
                            <h6><i class="fas fa-phone"></i> Contact</h6>
                            <p class="mb-0">{{ destination.contact_number }}</p>
                        </div>
                        {% endif %}

                        {% if destination.email %}
                        <div class="info-card">
                            <h6><i class="fas fa-envelope"></i> Email</h6>
                            <p class="mb-0">{{ destination.email }}</p>
                        </div>
                        {% endif %}

                        {% if destination.website %}
                        <div class="info-card">
                            <h6><i class="fas fa-globe"></i> Website</h6>
                            <p class="mb-0"><a href="{{ destination.website }}" target="_blank">Visit Website</a></p>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="card">
                    <div class="card-body">
                        <h5><i class="fas fa-map-marked-alt"></i> Plan Your Visit</h5>
                        <a href="/#destinations" class="btn btn-outline-primary w-100 mb-2">
                            <i class="fas fa-compass"></i> Explore More Places
                        </a>
                        <a href="/" class="btn btn-primary w-100">
                            <i class="fas fa-home"></i> Back to Homepage
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-white text-center py-4">
        <p>&copy; 2025 Tourism Guide System. All rights reserved.</p>
        <p><small>Powered by FastAPI & OpenStreetMap</small></p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    {% if destination.latitude and destination.longitude %}
    <script>
        const map = L.map('map').setView([{{ destination.latitude }}, {{ destination.longitude }}], 15);
        
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors',
            maxZoom: 19
        }).addTo(map);
        
        L.marker([{{ destination.latitude }}, {{ destination.longitude }}])
            .addTo(map)
            .bindPopup('<h6>{{ destination.name }}</h6><p>{{ destination.address }}</p>')
            .openPopup();
    </script>
    {% endif %}
</body>
</html>